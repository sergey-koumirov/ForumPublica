<% define "app/market_items/index.html" %>
<% template "base_head" .%>
<div id="market-items" market-items="<% .MarketItems | Marshal %>" v-cloak>

  <h5>
    Market
    <span class="oi oi-plus pointer" v-on:click="OpenAddModal()"></span>  
  </h5>

  <pagination :total="data.Total" :current="data.Page" :pp="data.PerPage"></pagination>

  <table class="table table-striped table-sm">
    <tr>
      <th></th>
      <th><b>What</b></th>
      <th>Where / Store</th>
      <th>Lowest / My price</th>
      <th>Market / Store Qty</th>
      <th></th>
      <th></th>
    </tr>
    <tr v-for="record in data.Records">
      <td>
        <img align="left" width="64" height="64" :src="'https://images.evetech.net/types/'+record.TypeID+'/icon?size=64'">
      </td>
      <td>
        <b>{{record.TypeName}}</b>
        <br/>
        <div class="round-border pointer" v-on:click="OpenWhereModal(record.ModelID)">
          <span class="oi oi-plus"></span>
          <span class="oi oi-map-marker"></span>
        </div>

        <div class="round-border pointer" v-on:click="OpenStoreModal(record.ModelID)">
          <span class="oi oi-plus"></span>
          <span class="oi oi-box"></span>
        </div>
      </td>

      <td>
        <ul class="simple-list">
          <li v-for="location in record.Locations">
            <img class="icon-suggestion" width="16" height="16" :src="'/assets/images/'+location.Type+'.png'" />
            {{location.Name}} <span class="gray">{{location.CharacterName}}</span>
            <span class="oi oi-delete pointer" @click="DeleteMarketLocation(record.TypeID, location.ID)"></span>
          </li>
        </ul>
        <hr class="divider" v-if="record.Stores.length>0">
        <ul class="simple-list" v-if="record.Stores.length>0">
          <li v-for="store in record.Stores">
            <img class="icon-suggestion" width="16" height="16" :src="'/assets/images/'+store.Type+'.png'" />
            {{store.Name}} [{{store.Qty | number}}] <span class="gray">{{store.CharacterName}}</span>
            <span class="oi oi-delete pointer" @click="DeleteMarketStore(record.ModelID, store.ID)"></span>
          </li>
        </ul>
      </td>

      <td class="text-right">
        <div class="gray-square" v-bind:class="{ 'orange-square': record.LowestPrice < record.MyPrice }">
          <span>{{record.LowestPrice | float}}</span>
        </div>
        <div class="gray-square">
          <span v-if="record.MyPrice>0">{{record.MyPrice | float}}</span>
        </div>
      </td>

      <td class="text-right">
        <div class="gray-square">
          <span v-if="record.MyVol>0">{{record.MyVol | number}}</span>
        </div>
        <div class="gray-square">
          <span v-if="record.StoreVol>0">{{record.StoreVol | number}}</span>
        </div>
      </td>

      <td></td>
      <td class="text-right">
        <a :href="`/app/market_item/${record.ModelID}/delete`"><span class="oi oi-delete"></span></a>
      </td>
    </tr>
  </table>

  <% template "app/market_items/_add_modal.html" . %>
  <% template "app/market_items/_where_modal.html" . %>
  <% template "app/market_items/_store_modal.html" . %>

</div>

<script src="/assets/js/vue.js"></script>
<script src="/assets/js/toastify.js"></script>
<script src="/assets/js/component.modal.js"></script>
<script src="/assets/js/component.type-select.js"></script>
<script src="/assets/js/component.location-select.js"></script>
<script src="/assets/js/component.pagination.js"></script>
<script src="/assets/js/vue.filters.js"></script>
<script src="/assets/js/controller.market_items.js"></script>


<% template "base_foot" %>
<% end %>
